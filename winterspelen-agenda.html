<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winterspelen 2026 - Google Agenda Tool</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a1628; color: #e0e6ed; min-height: 100vh; }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        h1 { text-align: center; margin-bottom: 8px; font-size: 1.8em; background: linear-gradient(135deg, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { text-align: center; color: #7a8ba3; margin-bottom: 24px; font-size: 0.95em; }
        .filters { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 24px; justify-content: center; }
        .filter-btn { padding: 8px 16px; border: 1px solid #2a3a52; border-radius: 20px; background: #131f33; color: #94a3b8; cursor: pointer; font-size: 0.85em; transition: all 0.2s; }
        .filter-btn:hover { border-color: #60a5fa; color: #60a5fa; }
        .filter-btn.active { background: #1e3a5f; border-color: #60a5fa; color: #60a5fa; }
        .filter-btn.all { background: #1a2744; border-color: #4a6fa5; color: #8ab4f8; }
        .filter-btn.all.active { background: #1e3a5f; border-color: #60a5fa; color: #60a5fa; }
        .actions-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding: 0 4px; flex-wrap: wrap; gap: 8px; }
        .select-all-wrap { display: flex; align-items: center; gap: 8px; }
        .select-all-wrap input { width: 18px; height: 18px; cursor: pointer; accent-color: #60a5fa; }
        .select-all-wrap label { color: #7a8ba3; cursor: pointer; font-size: 0.9em; }
        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; }
        .add-selected { padding: 8px 20px; border: none; border-radius: 8px; background: linear-gradient(135deg, #2563eb, #7c3aed); color: white; cursor: pointer; font-size: 0.9em; font-weight: 600; transition: opacity 0.2s; }
        .add-selected:hover { opacity: 0.9; }
        .add-selected:disabled { opacity: 0.4; cursor: not-allowed; }
        .download-ics { padding: 8px 20px; border: 1px solid #2a3a52; border-radius: 8px; background: transparent; color: #94a3b8; cursor: pointer; font-size: 0.9em; font-weight: 600; transition: all 0.2s; }
        .download-ics:hover { border-color: #60a5fa; color: #60a5fa; }
        .download-ics:disabled { opacity: 0.4; cursor: not-allowed; }
        .count-badge { background: #1e3a5f; color: #60a5fa; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; margin-left: 6px; }
        .day-group { margin-bottom: 20px; }
        .day-header { font-size: 1.1em; font-weight: 700; color: #60a5fa; padding: 10px 0 8px 4px; border-bottom: 1px solid #1e2d44; margin-bottom: 8px; position: sticky; top: 0; background: #0a1628; z-index: 1; }
        .event-card { display: flex; align-items: center; gap: 12px; padding: 10px 12px; border-radius: 8px; margin-bottom: 4px; transition: background 0.15s; cursor: pointer; }
        .event-card:hover { background: #131f33; }
        .event-card input[type="checkbox"] { width: 18px; height: 18px; flex-shrink: 0; cursor: pointer; accent-color: #60a5fa; }
        .event-time { font-weight: 600; color: #8ab4f8; min-width: 50px; font-size: 0.9em; }
        .event-details { flex: 1; }
        .event-title { font-size: 0.9em; color: #e0e6ed; display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
        .event-athletes { font-size: 0.8em; color: #6b7f99; margin-top: 2px; }
        .sport-tag { font-size: 0.7em; padding: 2px 8px; border-radius: 10px; font-weight: 500; flex-shrink: 0; }
        .tag-schaatsen { background: #1a3350; color: #60a5fa; }
        .tag-shorttrack { background: #1a3340; color: #34d399; }
        .tag-snowboarden { background: #2d1f3d; color: #a78bfa; }
        .tag-skeleton { background: #3d2b1a; color: #fbbf24; }
        .tag-bobsleeen { background: #3d1a1a; color: #f87171; }
        .tag-kunstrijden { background: #1a3d3d; color: #67e8f9; }
        .event-gcal { flex-shrink: 0; padding: 6px 12px; border: 1px solid #2a3a52; border-radius: 6px; background: transparent; color: #7a8ba3; cursor: pointer; font-size: 0.8em; transition: all 0.2s; text-decoration: none; }
        .event-gcal:hover { border-color: #60a5fa; color: #60a5fa; }
        .hidden { display: none; }
        .no-results { text-align: center; padding: 40px; color: #4a5f7a; }
        .method-info { text-align: center; color: #4a6580; font-size: 0.8em; margin-bottom: 16px; padding: 10px; background: #0d1b2e; border-radius: 8px; border: 1px solid #1e2d44; line-height: 1.5; }
        .method-info strong { color: #60a5fa; }
        @media (max-width: 600px) {
            .event-card { flex-wrap: wrap; }
            .event-gcal { width: 100%; text-align: center; margin-top: 4px; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Winterspelen Milano Cortina 2026</h1>
    <p class="subtitle">Nederlandse deelnemers - Google Agenda Tool</p>

    <div class="filters" id="filters"></div>

    <div class="actions-bar">
        <div class="select-all-wrap">
            <input type="checkbox" id="selectAll">
            <label for="selectAll">Alles selecteren</label>
            <span class="count-badge" id="countBadge">0 geselecteerd</span>
        </div>
        <div class="btn-group">
            <button class="download-ics" id="downloadIcs" disabled>Download .ics bestand</button>
        </div>
    </div>

    <div class="method-info">
        <strong>+ Agenda</strong> = direct toevoegen (1 event per keer) &nbsp;|&nbsp; <strong>Download .ics</strong> = selecteer meerdere events, download het bestand en importeer via <a href="https://calendar.google.com/calendar/r/settings/export" target="_blank" style="color:#60a5fa;">Google Agenda &rarr; Instellingen &rarr; Importeren</a>
    </div>

    <div id="eventList"></div>
</div>

<script>
const DURATION_MS = 45 * 60 * 1000; // 45 minuten

const events = [
    // Zondag 8 februari
    { date: "2026-02-08", day: "Zondag 8 februari", time: "09:00", sport: "Snowboarden", title: "Parallelreuzenslalom (v), kwalificaties", athletes: "Michelle Dekker" },
    { date: "2026-02-08", day: "Zondag 8 februari", time: "13:00", sport: "Snowboarden", title: "Parallelreuzenslalom (v), achtste finales", athletes: "mogelijk Michelle Dekker" },
    { date: "2026-02-08", day: "Zondag 8 februari", time: "13:48", sport: "Snowboarden", title: "Parallelreuzenslalom (v), kwartfinales", athletes: "mogelijk Michelle Dekker" },
    { date: "2026-02-08", day: "Zondag 8 februari", time: "14:12", sport: "Snowboarden", title: "Parallelreuzenslalom (v), halve finales", athletes: "mogelijk Michelle Dekker" },
    { date: "2026-02-08", day: "Zondag 8 februari", time: "14:29", sport: "Snowboarden", title: "Parallelreuzenslalom (v), finale", athletes: "mogelijk Michelle Dekker" },
    { date: "2026-02-08", day: "Zondag 8 februari", time: "16:00", sport: "Schaatsen", title: "5000 meter (m)", athletes: "Stijn van de Bunt, Chris Huizinga, Marcel Bosker" },
    { date: "2026-02-08", day: "Zondag 8 februari", time: "19:30", sport: "Snowboarden", title: "Big air (v), kwalificaties", athletes: "Melissa Peperkamp, Romy van Vreden" },

    // Maandag 9 februari
    { date: "2026-02-09", day: "Maandag 9 februari", time: "17:30", sport: "Schaatsen", title: "1000 meter (v)", athletes: "Jutta Leerdam, Femke Kok, Suzanne Schulting" },
    { date: "2026-02-09", day: "Maandag 9 februari", time: "19:30", sport: "Snowboarden", title: "Big air (v), finale", athletes: "mogelijk Melissa Peperkamp, Romy van Vreden" },

    // Dinsdag 10 februari
    { date: "2026-02-10", day: "Dinsdag 10 februari", time: "10:30", sport: "Shorttrack", title: "500 meter (v), series", athletes: "Xandra Velzeboer" },
    { date: "2026-02-10", day: "Dinsdag 10 februari", time: "11:08", sport: "Shorttrack", title: "1000 meter (m), series", athletes: "Jens van 't Wout" },
    { date: "2026-02-10", day: "Dinsdag 10 februari", time: "11:53", sport: "Shorttrack", title: "Gemengde aflossing, kwartfinales", athletes: "Nederland" },
    { date: "2026-02-10", day: "Dinsdag 10 februari", time: "12:23", sport: "Shorttrack", title: "Gemengde aflossing, halve finales", athletes: "mogelijk Nederland" },
    { date: "2026-02-10", day: "Dinsdag 10 februari", time: "12:56", sport: "Shorttrack", title: "Gemengde aflossing, finale", athletes: "mogelijk Nederland" },

    // Woensdag 11 februari
    { date: "2026-02-11", day: "Woensdag 11 februari", time: "18:30", sport: "Schaatsen", title: "1000 meter (m)", athletes: "Jenning de Boo, Joep Wennemars, Kjeld Nuis" },

    // Donderdag 12 februari
    { date: "2026-02-12", day: "Donderdag 12 februari", time: "10:00", sport: "Snowboarden", title: "Boardercross, kwalificaties", athletes: "Glenn de Blois" },
    { date: "2026-02-12", day: "Donderdag 12 februari", time: "13:45", sport: "Snowboarden", title: "Boardercross, achtste finales", athletes: "mogelijk Glenn de Blois" },
    { date: "2026-02-12", day: "Donderdag 12 februari", time: "14:18", sport: "Snowboarden", title: "Boardercross, kwartfinales", athletes: "mogelijk Glenn de Blois" },
    { date: "2026-02-12", day: "Donderdag 12 februari", time: "14:39", sport: "Snowboarden", title: "Boardercross, halve finales", athletes: "mogelijk Glenn de Blois" },
    { date: "2026-02-12", day: "Donderdag 12 februari", time: "14:56", sport: "Snowboarden", title: "Boardercross, finale", athletes: "mogelijk Glenn de Blois" },
    { date: "2026-02-12", day: "Donderdag 12 februari", time: "16:30", sport: "Schaatsen", title: "5000 meter (v)", athletes: "Merel Conijn, Bente Kerkhoff" },
    { date: "2026-02-12", day: "Donderdag 12 februari", time: "20:15", sport: "Shorttrack", title: "500 meter (v), kwartfinales", athletes: "mogelijk Xandra Velzeboer" },
    { date: "2026-02-12", day: "Donderdag 12 februari", time: "20:29", sport: "Shorttrack", title: "1000 meter (m), kwartfinales", athletes: "mogelijk Jens van 't Wout" },
    { date: "2026-02-12", day: "Donderdag 12 februari", time: "20:58", sport: "Shorttrack", title: "500 meter (v), halve finales", athletes: "mogelijk Xandra Velzeboer" },
    { date: "2026-02-12", day: "Donderdag 12 februari", time: "21:05", sport: "Shorttrack", title: "1000 meter (m), halve finales", athletes: "mogelijk Jens van 't Wout" },
    { date: "2026-02-12", day: "Donderdag 12 februari", time: "21:31", sport: "Shorttrack", title: "500 meter (v), finale", athletes: "mogelijk Xandra Velzeboer" },
    { date: "2026-02-12", day: "Donderdag 12 februari", time: "21:43", sport: "Shorttrack", title: "1000 meter (m), finale", athletes: "mogelijk Jens van 't Wout" },

    // Vrijdag 13 februari
    { date: "2026-02-13", day: "Vrijdag 13 februari", time: "16:00", sport: "Schaatsen", title: "10.000 meter (m)", athletes: "Stijn van de Bunt, Jorrit Bergsma" },
    { date: "2026-02-13", day: "Vrijdag 13 februari", time: "16:00", sport: "Skeleton", title: "Heat 1 (v)", athletes: "Kimberley Bos" },
    { date: "2026-02-13", day: "Vrijdag 13 februari", time: "17:48", sport: "Skeleton", title: "Heat 2 (v)", athletes: "Kimberley Bos" },

    // Zaterdag 14 februari
    { date: "2026-02-14", day: "Zaterdag 14 februari", time: "16:00", sport: "Schaatsen", title: "Ploegenachtervolging (v), kwartfinales", athletes: "Nederland" },
    { date: "2026-02-14", day: "Zaterdag 14 februari", time: "17:00", sport: "Schaatsen", title: "500 meter (m)", athletes: "Jenning de Boo, Sebas Diniz, Joep Wennemars" },
    { date: "2026-02-14", day: "Zaterdag 14 februari", time: "18:00", sport: "Skeleton", title: "Heat 3 (v)", athletes: "Kimberley Bos" },
    { date: "2026-02-14", day: "Zaterdag 14 februari", time: "19:44", sport: "Skeleton", title: "Heat 4 (v)", athletes: "Kimberley Bos" },
    { date: "2026-02-14", day: "Zaterdag 14 februari", time: "20:15", sport: "Shorttrack", title: "1500 meter (m), kwartfinales", athletes: "mogelijk Jens van 't Wout" },
    { date: "2026-02-14", day: "Zaterdag 14 februari", time: "20:59", sport: "Shorttrack", title: "1000 meter (v), series", athletes: "Xandra Velzeboer" },
    { date: "2026-02-14", day: "Zaterdag 14 februari", time: "21:44", sport: "Shorttrack", title: "1500 meter (m), halve finales", athletes: "mogelijk Jens van 't Wout" },
    { date: "2026-02-14", day: "Zaterdag 14 februari", time: "22:00", sport: "Shorttrack", title: "Aflossing (v), halve finales", athletes: "Nederland" },
    { date: "2026-02-14", day: "Zaterdag 14 februari", time: "22:34", sport: "Shorttrack", title: "1500 meter (m), finale", athletes: "mogelijk Jens van 't Wout" },

    // Zondag 15 februari
    { date: "2026-02-15", day: "Zondag 15 februari", time: "16:00", sport: "Schaatsen", title: "Ploegenachtervolging (m), kwartfinales", athletes: "Nederland" },
    { date: "2026-02-15", day: "Zondag 15 februari", time: "17:03", sport: "Schaatsen", title: "500 meter (v)", athletes: "Femke Kok, Jutta Leerdam, Anna Boersma" },
    { date: "2026-02-15", day: "Zondag 15 februari", time: "19:45", sport: "Kunstrijden", title: "Paren, korte kür", athletes: "Michel Tsiba, Daria Danilova" },

    // Maandag 16 februari
    { date: "2026-02-16", day: "Maandag 16 februari", time: "10:00", sport: "Bobsleeën", title: "Tweemansbob (m), heat 1", athletes: "Dave Wesselink, Jelen Franjic" },
    { date: "2026-02-16", day: "Maandag 16 februari", time: "10:30", sport: "Snowboarden", title: "Slopestyle (v), kwalificaties", athletes: "Melissa Peperkamp, Romy van Vreden" },
    { date: "2026-02-16", day: "Maandag 16 februari", time: "11:00", sport: "Shorttrack", title: "1000 meter (v), kwartfinales", athletes: "mogelijk Xandra Velzeboer" },
    { date: "2026-02-16", day: "Maandag 16 februari", time: "11:18", sport: "Shorttrack", title: "500 meter (m), series", athletes: "Jens van 't Wout" },
    { date: "2026-02-16", day: "Maandag 16 februari", time: "11:55", sport: "Shorttrack", title: "1000 meter (v), halve finales", athletes: "mogelijk Xandra Velzeboer" },
    { date: "2026-02-16", day: "Maandag 16 februari", time: "11:57", sport: "Bobsleeën", title: "Tweemansbob (m), heat 2", athletes: "Dave Wesselink, Jelen Franjic" },
    { date: "2026-02-16", day: "Maandag 16 februari", time: "12:04", sport: "Shorttrack", title: "Aflossing (m), halve finales", athletes: "Nederland" },
    { date: "2026-02-16", day: "Maandag 16 februari", time: "12:42", sport: "Shorttrack", title: "1000 meter (v), finale", athletes: "mogelijk Xandra Velzeboer" },
    { date: "2026-02-16", day: "Maandag 16 februari", time: "20:00", sport: "Kunstrijden", title: "Paren, vrije kür", athletes: "mogelijk Michel Tsiba, Daria Danilova" },

    // Dinsdag 17 februari
    { date: "2026-02-17", day: "Dinsdag 17 februari", time: "13:00", sport: "Snowboarden", title: "Slopestyle (v), finale", athletes: "mogelijk Melissa Peperkamp, Romy van Vreden" },
    { date: "2026-02-17", day: "Dinsdag 17 februari", time: "14:30", sport: "Schaatsen", title: "Ploegenachtervolging (m), halve finales", athletes: "mogelijk Nederland" },
    { date: "2026-02-17", day: "Dinsdag 17 februari", time: "14:52", sport: "Schaatsen", title: "Ploegenachtervolging (v), halve finales", athletes: "mogelijk Nederland" },
    { date: "2026-02-17", day: "Dinsdag 17 februari", time: "16:28", sport: "Schaatsen", title: "Ploegenachtervolging (m), finale", athletes: "mogelijk Nederland" },
    { date: "2026-02-17", day: "Dinsdag 17 februari", time: "16:47", sport: "Schaatsen", title: "Ploegenachtervolging (v), finale", athletes: "mogelijk Nederland" },
    { date: "2026-02-17", day: "Dinsdag 17 februari", time: "19:00", sport: "Bobsleeën", title: "Tweemansbob (m), heat 3", athletes: "Dave Wesselink, Jelen Franjic" },
    { date: "2026-02-17", day: "Dinsdag 17 februari", time: "21:05", sport: "Bobsleeën", title: "Tweemansbob (m), heat 4", athletes: "mogelijk Dave Wesselink, Jelen Franjic" },

    // Woensdag 18 februari
    { date: "2026-02-18", day: "Woensdag 18 februari", time: "20:15", sport: "Shorttrack", title: "500 meter (m), kwartfinales", athletes: "mogelijk Jens van 't Wout" },
    { date: "2026-02-18", day: "Woensdag 18 februari", time: "20:42", sport: "Shorttrack", title: "500 meter (m), halve finales", athletes: "mogelijk Jens van 't Wout" },
    { date: "2026-02-18", day: "Woensdag 18 februari", time: "20:59", sport: "Shorttrack", title: "Aflossing (v), finale", athletes: "mogelijk Nederland" },
    { date: "2026-02-18", day: "Woensdag 18 februari", time: "21:29", sport: "Shorttrack", title: "500 meter (m), finale", athletes: "mogelijk Jens van 't Wout" },

    // Donderdag 19 februari
    { date: "2026-02-19", day: "Donderdag 19 februari", time: "16:30", sport: "Schaatsen", title: "1500 meter (m)", athletes: "Joep Wennemars, Tijmen Snel, Kjeld Nuis" },

    // Vrijdag 20 februari
    { date: "2026-02-20", day: "Vrijdag 20 februari", time: "16:30", sport: "Schaatsen", title: "1500 meter (v)", athletes: "Marijke Groenewoud, Antoinette Rijpma-de Jong, Femke Kok" },
    { date: "2026-02-20", day: "Vrijdag 20 februari", time: "20:15", sport: "Shorttrack", title: "1500 meter (v), kwartfinales", athletes: "Suzanne Schulting, Xandra Velzeboer" },
    { date: "2026-02-20", day: "Vrijdag 20 februari", time: "21:00", sport: "Shorttrack", title: "1500 meter (v), halve finales", athletes: "mogelijk Suzanne Schulting, Xandra Velzeboer" },
    { date: "2026-02-20", day: "Vrijdag 20 februari", time: "21:29", sport: "Shorttrack", title: "Aflossing (m), finale", athletes: "mogelijk Nederland" },
    { date: "2026-02-20", day: "Vrijdag 20 februari", time: "22:03", sport: "Shorttrack", title: "1500 meter (v), finale", athletes: "mogelijk Suzanne Schulting, Xandra Velzeboer" },

    // Zaterdag 21 februari
    { date: "2026-02-21", day: "Zaterdag 21 februari", time: "10:00", sport: "Bobsleeën", title: "Viermansbob (m), heat 1", athletes: "Timme Koster, Jelen Franjic, Janko Franjic, Dave Wesselink" },
    { date: "2026-02-21", day: "Zaterdag 21 februari", time: "11:57", sport: "Bobsleeën", title: "Viermansbob (m), heat 2", athletes: "Timme Koster, Jelen Franjic, Janko Franjic, Dave Wesselink" },
    { date: "2026-02-21", day: "Zaterdag 21 februari", time: "15:00", sport: "Schaatsen", title: "Massastart (m), halve finales", athletes: "Jorrit Bergsma, Stijn van de Bunt" },
    { date: "2026-02-21", day: "Zaterdag 21 februari", time: "15:50", sport: "Schaatsen", title: "Massastart (v), halve finales", athletes: "Marijke Groenewoud, Bente Kerkhoff" },
    { date: "2026-02-21", day: "Zaterdag 21 februari", time: "16:40", sport: "Schaatsen", title: "Massastart (m), finale", athletes: "mogelijk Jorrit Bergsma, Stijn van de Bunt" },
    { date: "2026-02-21", day: "Zaterdag 21 februari", time: "17:15", sport: "Schaatsen", title: "Massastart (v), finale", athletes: "mogelijk Marijke Groenewoud, Bente Kerkhoff" },

    // Zondag 22 februari
    { date: "2026-02-22", day: "Zondag 22 februari", time: "10:00", sport: "Bobsleeën", title: "Viermansbob (m), heat 3", athletes: "Timme Koster, Jelen Franjic, Janko Franjic, Dave Wesselink" },
    { date: "2026-02-22", day: "Zondag 22 februari", time: "11:57", sport: "Bobsleeën", title: "Viermansbob (m), heat 4", athletes: "mogelijk Timme Koster, Jelen Franjic, Janko Franjic, Dave Wesselink" },
];

const sports = [...new Set(events.map(e => e.sport))].sort();
const sportClasses = {
    "Schaatsen": "tag-schaatsen",
    "Shorttrack": "tag-shorttrack",
    "Snowboarden": "tag-snowboarden",
    "Skeleton": "tag-skeleton",
    "Bobsleeën": "tag-bobsleeen",
    "Kunstrijden": "tag-kunstrijden"
};

let activeFilters = new Set();
let selectedEvents = new Set();

function initFilters() {
    const container = document.getElementById('filters');
    const allBtn = document.createElement('button');
    allBtn.className = 'filter-btn all active';
    allBtn.textContent = 'Alle sporten';
    allBtn.onclick = () => {
        activeFilters.clear();
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        allBtn.classList.add('active');
        renderEvents();
    };
    container.appendChild(allBtn);

    sports.forEach(sport => {
        const btn = document.createElement('button');
        btn.className = 'filter-btn';
        btn.textContent = sport;
        btn.onclick = () => {
            if (activeFilters.has(sport)) {
                activeFilters.delete(sport);
            } else {
                activeFilters.add(sport);
            }
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            if (activeFilters.size === 0) {
                allBtn.classList.add('active');
            } else {
                activeFilters.forEach(s => {
                    [...container.children].find(b => b.textContent === s)?.classList.add('active');
                });
            }
            renderEvents();
        };
        container.appendChild(btn);
    });
}

function getGCalUrl(event) {
    const [h, m] = event.time.split(':');
    const start = new Date(event.date + 'T' + h.padStart(2,'0') + ':' + m.padStart(2,'0') + ':00');
    const end = new Date(start.getTime() + DURATION_MS);
    const fmt = d => d.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '');
    const title = `${event.sport}: ${event.title}`;
    const details = `Deelnemers: ${event.athletes}`;
    return `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${fmt(start)}/${fmt(end)}&details=${encodeURIComponent(details)}&location=${encodeURIComponent('Milano Cortina, Italië')}`;
}

function toICSDate(date, time) {
    const [h, m] = time.split(':');
    return date.replace(/-/g, '') + 'T' + h.padStart(2,'0') + m.padStart(2,'0') + '00';
}

function toICSEndDate(date, time) {
    const [h, m] = time.split(':');
    const start = new Date(date + 'T' + h.padStart(2,'0') + ':' + m.padStart(2,'0') + ':00');
    const end = new Date(start.getTime() + DURATION_MS);
    const pad = n => String(n).padStart(2, '0');
    return end.getFullYear() + pad(end.getMonth()+1) + pad(end.getDate()) + 'T' + pad(end.getHours()) + pad(end.getMinutes()) + '00';
}

function escapeICS(str) {
    return str.replace(/\\/g, '\\\\').replace(/;/g, '\\;').replace(/,/g, '\\,').replace(/\n/g, '\\n');
}

function generateICS(indices) {
    const now = new Date();
    const pad = n => String(n).padStart(2, '0');
    const dtstamp = now.getUTCFullYear() + pad(now.getUTCMonth()+1) + pad(now.getUTCDate()) + 'T' + pad(now.getUTCHours()) + pad(now.getUTCMinutes()) + pad(now.getUTCSeconds()) + 'Z';

    let ics = `BEGIN:VCALENDAR\r\nVERSION:2.0\r\nPRODID:-//Winterspelen 2026//NL\r\nCALSCALE:GREGORIAN\r\nMETHOD:PUBLISH\r\nX-WR-CALNAME:Winterspelen 2026 NL\r\nX-WR-TIMEZONE:Europe/Amsterdam\r\nBEGIN:VTIMEZONE\r\nTZID:Europe/Amsterdam\r\nBEGIN:STANDARD\r\nDTSTART:19701025T030000\r\nRRULE:FREQ=YEARLY;BYDAY=-1SU;BYMONTH=10\r\nTZOFFSETFROM:+0200\r\nTZOFFSETTO:+0100\r\nTZNAME:CET\r\nEND:STANDARD\r\nBEGIN:DAYLIGHT\r\nDTSTART:19700329T020000\r\nRRULE:FREQ=YEARLY;BYDAY=-1SU;BYMONTH=3\r\nTZOFFSETFROM:+0100\r\nTZOFFSETTO:+0200\r\nTZNAME:CEST\r\nEND:DAYLIGHT\r\nEND:VTIMEZONE\r\n`;

    indices.forEach(idx => {
        const e = events[idx];
        const uid = `ws2026-${e.date}-${e.time.replace(':','')}-${idx}@olympical.nl`;
        const dtstart = toICSDate(e.date, e.time);
        const dtend = toICSEndDate(e.date, e.time);
        const summary = `${e.sport}: ${e.title}`;
        const description = `Deelnemers: ${e.athletes}`;

        ics += `BEGIN:VEVENT\r\n`;
        ics += `UID:${uid}\r\n`;
        ics += `DTSTAMP:${dtstamp}\r\n`;
        ics += `DTSTART;TZID=Europe/Amsterdam:${dtstart}\r\n`;
        ics += `DTEND;TZID=Europe/Amsterdam:${dtend}\r\n`;
        ics += `SUMMARY:${escapeICS(summary)}\r\n`;
        ics += `DESCRIPTION:${escapeICS(description)}\r\n`;
        ics += `LOCATION:Milano Cortina\\, Italië\r\n`;
        ics += `STATUS:CONFIRMED\r\n`;
        ics += `END:VEVENT\r\n`;
    });

    ics += `END:VCALENDAR\r\n`;
    return ics;
}

function downloadICS() {
    const selected = [...selectedEvents].sort((a,b) => a - b);
    if (selected.length === 0) return;

    const icsContent = generateICS(selected);
    const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'winterspelen-2026.ics';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function updateCount() {
    document.getElementById('countBadge').textContent = `${selectedEvents.size} geselecteerd`;
    document.getElementById('downloadIcs').disabled = selectedEvents.size === 0;
}

function renderEvents() {
    const container = document.getElementById('eventList');
    const filtered = activeFilters.size === 0 ? events : events.filter(e => activeFilters.has(e.sport));

    if (filtered.length === 0) {
        container.innerHTML = '<div class="no-results">Geen evenementen gevonden</div>';
        return;
    }

    const grouped = {};
    filtered.forEach((e, i) => {
        const idx = events.indexOf(e);
        if (!grouped[e.day]) grouped[e.day] = [];
        grouped[e.day].push({ ...e, idx });
    });

    let html = '';
    for (const [day, dayEvents] of Object.entries(grouped)) {
        html += `<div class="day-group"><div class="day-header">${day}</div>`;
        dayEvents.forEach(e => {
            const checked = selectedEvents.has(e.idx) ? 'checked' : '';
            const tagClass = sportClasses[e.sport] || '';
            html += `
                <div class="event-card" onclick="toggleEvent(${e.idx}, event)">
                    <input type="checkbox" ${checked} data-idx="${e.idx}" onclick="event.stopPropagation(); toggleEvent(${e.idx}, event)">
                    <span class="event-time">${e.time}</span>
                    <div class="event-details">
                        <div class="event-title"><span class="sport-tag ${tagClass}">${e.sport}</span> ${e.title}</div>
                        <div class="event-athletes">${e.athletes}</div>
                    </div>
                    <a class="event-gcal" href="${getGCalUrl(e)}" target="_blank" onclick="event.stopPropagation()">+ Agenda</a>
                </div>`;
        });
        html += '</div>';
    }
    container.innerHTML = html;
    updateCount();
}

function toggleEvent(idx, evt) {
    if (evt.target.tagName === 'A') return;
    if (selectedEvents.has(idx)) {
        selectedEvents.delete(idx);
    } else {
        selectedEvents.add(idx);
    }
    const cb = document.querySelector(`input[data-idx="${idx}"]`);
    if (cb) cb.checked = selectedEvents.has(idx);
    updateCount();
}

document.getElementById('selectAll').addEventListener('change', function() {
    const filtered = activeFilters.size === 0 ? events : events.filter(e => activeFilters.has(e.sport));
    if (this.checked) {
        filtered.forEach(e => selectedEvents.add(events.indexOf(e)));
    } else {
        filtered.forEach(e => selectedEvents.delete(events.indexOf(e)));
    }
    document.querySelectorAll('.event-card input[type="checkbox"]').forEach(cb => {
        cb.checked = this.checked;
    });
    updateCount();
});

document.getElementById('downloadIcs').addEventListener('click', downloadICS);

initFilters();
renderEvents();
</script>
</body>
</html>
